{% extends 'layout_tour.html' %}
{% block body %}
<a-scene>
<a-assets>
<!-- Click controls Browser -->  
  <script>
    AFRAME.registerComponent('next', {
      schema: {},
      init: function () {
        this.el.addEventListener('click', function () {
          window.location.href = "{{url_for('tour', topic=topic, current_pic=current_pic, command='next')}}";
        });
      }
    });
  </script>
  <script>
    AFRAME.registerComponent('back', {
      schema: {},
      init: function () {
        this.el.addEventListener('click', function () {
          window.location.href = "{{url_for('tour', topic=topic, current_pic=current_pic, command='back')}}";
        });
      }
    });
  </script>
  <script>
    AFRAME.registerComponent('stop', {
      schema: {},
      init: function () {
        this.el.addEventListener('click', function () {
          window.location.href = "{{url_for('home', file_list=file_list, tour_file_directory=tour_file_directory)}}";
        });
      }
    });
  </script>

<!-- VR controls-->
<!-- <script>
  AFRAME.registerComponent('custom-controls', {
    schema: {
      hand: {default: ''},
      model: {default: 'customControllerModel.gltf'}
    },

    update: function () {
      var hand = this.data.hand;
      var el = this.el;
      var controlConfiguration = {
        hand: hand,
        model: false,
        orientationOffset: {x: 0, y: 0, z: hand === 'left' ? 90 : -90}
      };

      // Build on top of controller components.
      el.setAttribute('vive-controls', controlConfiguration);
      el.setAttribute('oculus-touch-controls', controlConfiguration);
      el.setAttribute('daydream-controls', controlConfiguration);
      el.setAttribute('gearvr-controls', controlConfiguration);
      el.setAttribute('windows-motion-controls', controlConfiguration);

      // Set a model.
      el.setAttribute('gltf-model', this.data.model);
    }
  });
</script>
<scrip>
  AFRAME.registerComponent('x-button-listener', {
    init: function () {
      var el = this.el;
      el.addEventListener('xbuttondown', function (evt) {
        el.setAttribute('visible', !el.getAttribute('visible'));
      });
    }
  });
</scrip> -->

<!-- Image link template -->
  <script id="link" type="text/html">
    <a-entity class="link"
      geometry="primitive: plane; height: 1; width: 1"
      material="shader: flat; src: ${thumb}"
      event-set__mouseenter="scale: 1.2 1.2 1"
      event-set__mouseleave="scale: 1 1 1"
      sound="on: click; src: #click-sound"></a-entity>
  </script>
  <img id="next" src="{{url_for('static', filename='next.jpg')}}">
  <img id="back" src="{{url_for('static', filename='back.jpg')}}">
  <img id="stop" src="{{url_for('static', filename='stop.jpg')}}">
  <audio id="click-sound" crossorigin="anonymous" src="https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg"></audio>
</a-assets
>
<!-- 360-degree image. -->
  <a-sky id="image-360" radius="15" src="{{url_for('static', filename=tour_file_directory ~ '/' ~ topic ~ '/' ~ current_pic ~'.jpg')}}" position="2 0 1" rotation="0 -130 0" ></a-sky> 
<!-- Image links. -->
<a-entity id="links" layout="type: line; margin: 1.5" position="-1 -1 -5">
<a-entity template="src: #link" data-thumb="#back" back></a-entity>
<a-entity template="src: #link" data-thumb="#stop" stop></a-entity>
<a-entity template="src: #link" data-thumb="#next" next></a-entity>
</a-entity>

<!-- VR controls -->
<!-- <a-entity hand-controls="left"></a-entity>
<a-entity hand-controls="right"></a-entity>
<a-entity laser-controls="hand: right"></a-entity>
<a-entity oculus-touch-controls x-button-listener></a-entity> -->

<a-entity cursor raycaster="far: 20; interval: 1000; objects: .clickable"></a-entity>


<!-- Camera + cursor -->
<a-camera>
  <a-cursor></a-cursor>
</a-camera>
</a-scene>
{% endblock %}


